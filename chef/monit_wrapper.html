<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Cookbook: monit_wrapper
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!chef/monit_wrapper.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../index.html">Index (m)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../chef.html" title="chef (chef)">chef</a></span></span>
     &raquo; 
    <span class="title">monit_wrapper</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="cookbooks_list_link"
        href="../cookbooks_list.html">
      Cookbook List
    </a>
  
    <a class="full_list_link" id="recipes_list_link"
        href="../recipes_list.html">
      Recipe List
    </a>
  
    <a class="full_list_link" id="resources_list_link"
        href="../resources_list.html">
      Resource List
    </a>
  
    <a class="full_list_link" id="definitions_list_link"
        href="../definitions_list.html">
      Definitions List
    </a>
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Libraries List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content">

<div id="filecontents">
  <h1>Cookbook : monit_wrapper</h1>
  

<h1>monit_wrapper</h1>

<p><a href="https://travis-ci.org/clearstorydata-cookbooks/monit_wrapper"><img src="https://travis-ci.org/clearstorydata-cookbooks/monit_wrapper.svg?branch=master" alt="Build Status"></a></p>

<p>This cookbook simplifies setting up services using Monit.</p>

<ul>
<li>GitHub: <a href="https://github.com/clearstorydata-cookbooks/monit_wrapper">https://github.com/clearstorydata-cookbooks/monit_wrapper</a></li>
<li>Chef Supermarket: <a href="https://supermarket.chef.io/cookbooks/monit_wrapper">https://supermarket.chef.io/cookbooks/monit_wrapper</a></li>
<li>Travis CI: <a href="https://travis-ci.org/clearstorydata-cookbooks/monit_wrapper">https://travis-ci.org/clearstorydata-cookbooks/monit_wrapper</a></li>
<li>Documentation: <a href="http://clearstorydata-cookbooks.github.io/monit_wrapper/chef/monit_wrapper.html">http://clearstorydata-cookbooks.github.io/monit_wrapper/chef/monit_wrapper.html</a></li>
</ul>

<h2>Examples</h2>

<h3>Custom Monit configuration template</h3>

<p>Create a configuration template in your cookbook <code>my_cookbook/templates/default/monit/my_service.conf.erb</code>:</p>

<pre class="code ruby"><code class="ruby">check process &lt;%= @service_name %&gt;
  matching &#39;&lt;%= @cmd_line_pattern %&gt;&#39;
  every 1 cycles
  start program &quot;/bin/bash -c &#39;exec &lt;%= @cmd_line %&gt;&#39;&quot;
    as uid &lt;%= @user %&gt; as gid &lt;%= @user %&gt;
  stop program &quot;/usr/bin/pkill -u &lt;%= @user %&gt; -f &#39;&lt;%= @cmd_line_pattern %&gt;&#39;&quot;
    as uid &lt;%= @user %&gt; as gid &lt;%= @user %&gt;
</code></pre>

<p>In <code>my_cookbook/recipes/default.rb</code>:</p>

<pre class="code ruby"><code class="ruby">
<span class='id identifier rubyid_my_service_name'>my_service_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>...</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_command_line'>command_line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/local/bin/my_service_executable --port 3456</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_monit_wrapper_monitor'>monit_wrapper_monitor</span> <span class='id identifier rubyid_my_service_name'>my_service_name</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_template_cookbook'>template_cookbook</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my_cookbook</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_template_source'>template_source</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit/my_service.conf.erb</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_variables'>variables</span> <span class='label'>cmd_line:</span> <span class='id identifier rubyid_command_line'>command_line</span><span class='comma'>,</span>
            <span class='label'>cmd_line_pattern:</span> <span class='id identifier rubyid_command_line'>command_line</span><span class='comma'>,</span>
            <span class='label'>user:</span> <span class='id identifier rubyid_user'>user</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_monit_wrapper_notify_if_not_running'>monit_wrapper_notify_if_not_running</span> <span class='id identifier rubyid_monit_service_name'>monit_service_name</span>

<span class='id identifier rubyid_monit_wrapper_service'>monit_wrapper_service</span> <span class='id identifier rubyid_my_service_name'>my_service_name</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_subscribes'>subscribes</span> <span class='symbol'>:restart</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monit_wrapper_monitor[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_my_service_name'>my_service_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:delayed</span>
  <span class='id identifier rubyid_subscribes'>subscribes</span> <span class='symbol'>:restart</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monit_wrapper_notify_if_not_running[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_my_service_name'>my_service_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:delayed</span>
  <span class='id identifier rubyid_subscribes'>subscribes</span> <span class='symbol'>:restart</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>package[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_my_service_name'>my_service_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:delayed</span>
<span class='kw'>end</span>
</code></pre>

<h3>Launching and monitoring a process with an existing init</h3>

<p>If you have a service with an existing <code>/etc/init.d</code> script, you can use this cookbook to create
a Monit configuration file to monitor that service. This makes use of the <a href="https://github.com/clearstorydata-cookbooks/monit_wrapper/blob/master/templates/default/service_wrapper.monitrc.erb">default Monit
configuration template</a>
this cookbook provides.</p>

<pre class="code ruby"><code class="ruby">my_sevice_name = &#39;my-service&#39;

monit_wrapper_monitor my_service_name do
  action :create
  pattern &#39;...&#39;
end

monit_wrapper_notify_if_not_running my_service_name do

monit_wrapper_service service_name do
  subscribes :restart, &quot;package[#{service_name}]&quot;, :delayed
  subscribes :restart, &quot;monit_wrapper_monitor[#{service_name}]&quot;, :delayed
  subscribes :restart, &quot;monit_wrapper_notify_if_not_running[#{service_name}]&quot;,
             :delayed
end
</code></pre>

<h2>License</h2>

<p>Apache License 2.0</p>

<p><a href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a></p>



<h1>Cookbook Documentation</h1>




  <h2>Recipes Summary</h2>
  <ul class="summary">
    
      <li>
        <span class="summary_signature">
          <strong><a href="#monit_wrapper::default">monit_wrapper::default</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
  </ul>




  <h2>Lightweight Resources</h2>
  
    <h3><a name="Chef::Resource::MonitWrapperService">monit_wrapper_service</a></h3>
    <ul>


  <h4>Actions</h4>
  
  <ul><table>
    <thead>
      <th>Action</th>
      <th>Description</th>
    </thead>
    <tbody>
      
        <tr class="r1">
          <td><strong>start</strong></td>
          <td>Starts the given Monit service.</td>
        </tr>
        
      
        <tr class="r2">
          <td><strong>stop</strong></td>
          <td>Stops the given Monit service.</td>
        </tr>
        
      
        <tr class="r1">
          <td><strong>restart</strong></td>
          <td>Restarts the given Monit service.</td>
        </tr>
        
      
        <tr class="r2">
          <td><strong>nothing</strong></td>
          <td>Does not do anything.</td>
        </tr>
        
      
    </tbody>
  </table></ul>




  <h4>Attributes</h4>
  <ul>


<table>
  <thead>
    <th>Attribute</th>
    <th>Description</th>
  </thead>
  <tbody>
    
      <tr class="r1">
        <td><strong>fallback_to_regular_service</strong></td>
        <td>If this is specified and the service is not registered with Monit, it will be started as a
regular service using the standard "service" resource.</td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>wait_for_host_port</strong></td>
        <td>A host:port combination of another service. If this is specified, we wait for this the given host
to start listening on the given TCP port before attempting to start or restart the service. This
could be used for handling dependencies on remote services.</td>
      </tr>
      
    
  </tbody>
</table>
</ul>




</ul>
  
    <h3><a name="Chef::Resource::MonitWrapperMonitor">monit_wrapper_monitor</a></h3>
    <ul>


  <h4>Actions</h4>
  
  <ul><table>
    <thead>
      <th>Action</th>
      <th>Description</th>
    </thead>
    <tbody>
      
        <tr class="r1">
          <td><strong>create</strong></td>
          <td>Creates a Monit service configuration file</td>
        </tr>
        
      
        <tr class="r2">
          <td><strong>delete</strong></td>
          <td>Deletes a Monit service configuration file</td>
        </tr>
        
      
    </tbody>
  </table></ul>




  <h4>Attributes</h4>
  <ul>


<table>
  <thead>
    <th>Attribute</th>
    <th>Description</th>
  </thead>
  <tbody>
    
      <tr class="r1">
        <td><strong>pid_file</strong></td>
        <td>Specifies the pid_file parameter of our default Monit service configuration template.</td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>pattern</strong></td>
        <td>Specifies the pattern parameter (the command line regular expression) of our default Monit service
configuration template.</td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>java_class</strong></td>
        <td>If this is specified, the command line regular expression is constructed automatically that
matches Java processes running the given class.</td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>variables</strong></td>
        <td>Additional variables to be used with the Monit service configuration template.</td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>template_source</strong></td>
        <td>The source file of the Monit configuration template. A default template is provided by this
cookbook.</td>
      </tr>
      
    
      <tr class="r2">
        <td><strong>template_cookbook</strong></td>
        <td>The cookbook to look for the Monit configuration template in.</td>
      </tr>
      
    
      <tr class="r1">
        <td><strong>wait_for_host_port</strong></td>
        <td>Wait for the given host:port combination to become available over TCP before proceeding with
Monit service configuration file creation.</td>
      </tr>
      
    
  </tbody>
</table>
</ul>




</ul>
  
    <h3><a name="Chef::Resource::MonitWrapperReloadAndWait">monit_wrapper_reload_and_wait</a></h3>
    <ul>


  <h4>Actions</h4>
  
  <ul><table>
    <thead>
      <th>Action</th>
      <th>Description</th>
    </thead>
    <tbody>
      
        <tr class="r1">
          <td><strong>reload_and_wait</strong></td>
          <td>Reloads Monit configuration and waits for Monit to start showing the given service in the list of
services it knows about. This is invoked by the monit_wrapper_monitor LWRP after creating a new
monit service configuration file.</td>
        </tr>
        
      
    </tbody>
  </table></ul>







</ul>
  
    <h3><a name="Chef::Resource::MonitWrapperNotifyIfNotRunning">monit_wrapper_notify_if_not_running</a></h3>
    <ul>


  <h4>Actions</h4>
  
  <ul><table>
    <thead>
      <th>Action</th>
      <th>Description</th>
    </thead>
    <tbody>
      
        <tr class="r1">
          <td><strong>run</strong></td>
          <td>Notifies other resources that subscribe to this resource if the specified Monit service is not
running.</td>
        </tr>
        
      
    </tbody>
  </table></ul>







</ul>
  




  <h2>Providers</h2>
  
    <h3><a name="Chef::Provider::MonitWrapperService">monit_wrapper_service</a></h3>
    <ul>


  <h4>Actions Summary</h4>
  <ul class="summary">
    
      <li>
        <span class="summary_signature">
          <strong><a href="#start">start</a></strong>
        </span>
        <span class="summary_desc">Start the given Monit service.</span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#stop">stop</a></strong>
        </span>
        <span class="summary_desc">Stop the given Monit service.</span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#restart">restart</a></strong>
        </span>
        <span class="summary_desc">Restart the given Monit service.</span>
      </li>
    
  </ul>

</ul>
  
    <h3><a name="Chef::Provider::MonitWrapperMonitor">monit_wrapper_monitor</a></h3>
    <ul>


  <h4>Actions Summary</h4>
  <ul class="summary">
    
      <li>
        <span class="summary_signature">
          <strong><a href="#create">create</a></strong>
        </span>
        <span class="summary_desc">Creates a configuration file for a new Monit-monitored service.</span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#delete">delete</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
  </ul>

</ul>
  
    <h3><a name="Chef::Provider::MonitWrapperReloadAndWait">monit_wrapper_reload_and_wait</a></h3>
    <ul>


  <h4>Actions Summary</h4>
  <ul class="summary">
    
      <li>
        <span class="summary_signature">
          <strong><a href="#reload_and_wait">reload_and_wait</a></strong>
        </span>
        <span class="summary_desc">Reload Monit configuration and wait for it to become aware of the given service.</span>
      </li>
    
  </ul>

</ul>
  
    <h3><a name="Chef::Provider::MonitWrapperNotifyIfNotRunning">monit_wrapper_notify_if_not_running</a></h3>
    <ul>


  <h4>Actions Summary</h4>
  <ul class="summary">
    
      <li>
        <span class="summary_signature">
          <strong><a href="#run">run</a></strong>
        </span>
        <span class="summary_desc">Notifies subscribing resources if the given Monit service is not running.</span>
      </li>
    
  </ul>

</ul>
  














<div class="method_details_list">
  



  <h2>Recipe Details</h2>
  
    <div class="method_details first">
      <h3 class="signature"><a name="monit_wrapper::default">
        <strong>monit_wrapper::default</strong>
      </a></h3>
      
      

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'recipes/default.rb', line 1</span>

<span class='comment'># Copyright 2015 ClearStory Data, Inc.
</span><span class='comment'>#
</span><span class='comment'># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
</span><span class='comment'># you may not use this file except in compliance with the License.
</span><span class='comment'># You may obtain a copy of the License at
</span><span class='comment'>#
</span><span class='comment'>#     http://www.apache.org/licenses/LICENSE-2.0
</span><span class='comment'>#
</span><span class='comment'># Unless required by applicable law or agreed to in writing, software
</span><span class='comment'># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
</span><span class='comment'># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span class='comment'># See the License for the specific language governing permissions and
</span><span class='comment'># limitations under the License.
</span>

<span class='kw'>if</span> <span class='id identifier rubyid_platform_family?'>platform_family?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rhel</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>install_method</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>source</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Setting node[&#39;monit&#39;][&#39;install_method&#39;] to &#39;source&#39; on a RedHat-based system because </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>the monit_wrapper cookbook requires a Monit version of 5.2 or later to utilize the </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;matching&#39; feature. Please note that this won&#39;t help if the monit-ng default recipe </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is included in the run list before the monit_wrapper recipe.</span><span class='tstring_end'>&quot;</span></span>
  <span class='rparen'>)</span>
  <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_override'>override</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>install_method</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>source</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_default'>default</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>executable</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/local/bin/monit</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>else</span>
  <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_default'>default</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>executable</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/bin/monit</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_include_recipe'>include_recipe</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit-ng</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># Ensure monit daemon is running. This may not happen on its own on Docker. We are not using the
</span><span class='comment'># &quot;service&quot; resource, because service[monit] is also defined in monit-ng, and we do not want to
</span><span class='comment'># interfere with that resource&#39;s execution here.
</span><span class='id identifier rubyid_ruby_block'>ruby_block</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit_wrapper_start_monit_service</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_block'>block</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_ensure_monit_daemon_is_running'>ensure_monit_daemon_is_running</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_chef_gem'>chef_gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>waitutil</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_template'>template</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/local/bin/start_stop_service_from_monit.sh</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_source'>source</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>start_stop_service_from_monit.sh.erb</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_owner'>owner</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_group'>group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_mode'>mode</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0744</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_variables'>variables</span> <span class='label'>timeout_sec:</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit_wrapper</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>start_stop_timeout_sec</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_template'>template</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/local/bin/monit_service_ctl.sh</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_source'>source</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit_service_ctl.sh.erb</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_owner'>owner</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_group'>group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_mode'>mode</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0755</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_variables'>variables</span> <span class='label'>monit_executable:</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>executable</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span>

<span class='comment'># We use this directory for lock files to ensure that no more than one process is trying to
</span><span class='comment'># start/stop a particular service from start_stop_service_from_monit.sh at any given moment.
</span><span class='id identifier rubyid_directory'>directory</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/var/monit</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_owner'>owner</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_group'>group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_mode'>mode</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0777</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

    </div>
  




  <h2>Action Details</h2>
  
    
    
      
        <div class="method_details first">
          <h3 class="signature"><a name="start">
            <strong>start</strong>
            &nbsp;(Chef::Provider::MonitWrapperService)
          </a></h3>
          <p>Start the given Monit service.</p>

          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/service.rb', line 19</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:start</span> <span class='kw'>do</span>  <span class='comment'># ~FC017
</span>  <span class='comment'># We disable FC017 because notifying_action_wrapper takes care of notifications.
</span>  <span class='id identifier rubyid_service_name'>service_name</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_notifying_action_wrapper'>notifying_action_wrapper</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_monit_service_running?'>monit_service_running?</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='rparen'>)</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Service </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_name'>service_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is already running, skipping start action</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_monit_service_registered?'>monit_service_registered?</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_wait_for_host_port'>wait_for_host_port</span><span class='lparen'>(</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_wait_for_host_port'>wait_for_host_port</span><span class='rparen'>)</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_monit_service_running?'>monit_service_running?</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='comma'>,</span> <span class='label'>verbose:</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_start_monit_service'>start_monit_service</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_fallback_to_regular_service'>fallback_to_regular_service</span>
      <span class='id identifier rubyid_wait_for_host_port'>wait_for_host_port</span><span class='lparen'>(</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_wait_for_host_port'>wait_for_host_port</span><span class='rparen'>)</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No Monit service </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_name'>service_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> registered, failling back to starting a regular service</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_service'>service</span> <span class='id identifier rubyid_service_name'>service_name</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:start</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Monit does not know about </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_name'>service_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> and fallback_to_regular_service is disabled</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="stop">
            <strong>stop</strong>
            &nbsp;(Chef::Provider::MonitWrapperService)
          </a></h3>
          <p>Stop the given Monit service.</p>

          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/service.rb', line 44</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:stop</span> <span class='kw'>do</span>  <span class='comment'># ~FC017
</span>  <span class='comment'># We disable FC017 because notifying_action_wrapper takes care of notifications.
</span>  <span class='id identifier rubyid_service_name'>service_name</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_notifying_action_wrapper'>notifying_action_wrapper</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_monit_service_registered?'>monit_service_registered?</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_stop_monit_service'>stop_monit_service</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_fallback_to_regular_service'>fallback_to_regular_service</span>
      <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No Monit service </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_name'>service_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> registered, failling back to stopping a regular service</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_service'>service</span> <span class='id identifier rubyid_service_name'>service_name</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:stop</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Monit does not know about </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_name'>service_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> and fallback_to_regular_service is disabled</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="restart">
            <strong>restart</strong>
            &nbsp;(Chef::Provider::MonitWrapperService)
          </a></h3>
          <p>Restart the given Monit service.</p>

          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/service.rb', line 63</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:restart</span> <span class='kw'>do</span>  <span class='comment'># ~FC017
</span>  <span class='comment'># We disable FC017 because notifying_action_wrapper takes care of notifications.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_monit_service_running?'>monit_service_running?</span><span class='lparen'>(</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>verbose:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>restart</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>start</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_wait_for_host_port'>wait_for_host_port</span><span class='lparen'>(</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_wait_for_host_port'>wait_for_host_port</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_notifying_action_wrapper'>notifying_action_wrapper</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_bash'>bash</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monit-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_command'>command</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_user'>user</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_code'>code</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>executable</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_command'>command</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:run</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
    
  
    
    
      
        <div class="method_details first">
          <h3 class="signature"><a name="create">
            <strong>create</strong>
            &nbsp;(Chef::Provider::MonitWrapperMonitor)
          </a></h3>
          <p>Creates a configuration file for a new Monit-monitored service.</p>

          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/monitor.rb', line 28</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create</span> <span class='kw'>do</span>  <span class='comment'># ~FC017
</span>  <span class='comment'># We disable FC017 (LWRP does not notify when updated) because we are using
</span>  <span class='comment'># notifying_action_wrapper that notifies all subscribers when the template is regenerated.
</span>
  <span class='id identifier rubyid_notifying_action_wrapper'>notifying_action_wrapper</span><span class='lparen'>(</span>
    <span class='label'>allow_updates_from:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>template[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_conf_path'>service_conf_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='label'>verbose:</span> <span class='kw'>true</span>
  <span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_wait_for_host_port'>wait_for_host_port</span><span class='lparen'>(</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_wait_for_host_port'>wait_for_host_port</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_variables'>variables</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_variables'>variables</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>

    <span class='id identifier rubyid_variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:service_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:pid_file</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_pid_file'>pid_file</span> <span class='kw'>if</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_pid_file'>pid_file</span>
    <span class='id identifier rubyid_variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:pattern</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_pattern'>pattern</span> <span class='kw'>if</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_pattern'>pattern</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_java_class'>java_class</span>
      <span class='id identifier rubyid_variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:pattern</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>^[^ ]*java .* </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_java_class'>java_class</span><span class='embexpr_end'>}</span><span class='tstring_content'>($| .*)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='lbracket'>[</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_pid_file'>pid_file</span><span class='comma'>,</span>
        <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_pattern'>pattern</span><span class='comma'>,</span>
        <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_java_class'>java_class</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No more than one of pid file, pattern, or Java class can be specified. </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Variables: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_variables'>variables</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Creating Monit configuration file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_conf_path'>service_conf_path</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for service </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='rparen'>)</span>
    <span class='id identifier rubyid_template'>template</span> <span class='id identifier rubyid_service_conf_path'>service_conf_path</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_owner'>owner</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_group'>group</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_mode'>mode</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0644</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_source'>source</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_template_source'>template_source</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>service_wrapper.conf.erb</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_cookbook'>cookbook</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_template_cookbook'>template_cookbook</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit_wrapper</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_variables'>variables</span> <span class='id identifier rubyid_variables'>variables</span>
      <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_file'>file</span> <span class='id identifier rubyid_deprecated_service_conf_path'>deprecated_service_conf_path</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:delete</span>
    <span class='kw'>end</span>

    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Reloading Monit configuration and waiting for service </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_monit_wrapper_reload_and_wait'>monit_wrapper_reload_and_wait</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
        <div class="method_details ">
          <h3 class="signature"><a name="delete">
            <strong>delete</strong>
            &nbsp;(Chef::Provider::MonitWrapperMonitor)
          </a></h3>
          
          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/monitor.rb', line 76</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:delete</span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_service_conf_path'>service_conf_path</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file'>file</span> <span class='id identifier rubyid_service_conf_path'>service_conf_path</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:delete</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_file'>file</span> <span class='id identifier rubyid_deprecated_service_conf_path'>deprecated_service_conf_path</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:delete</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_bash'>bash</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monit-reload-after-removing-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_code'>code</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit reload</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
    
  
    
    
      
        <div class="method_details first">
          <h3 class="signature"><a name="reload_and_wait">
            <strong>reload_and_wait</strong>
            &nbsp;(Chef::Provider::MonitWrapperReloadAndWait)
          </a></h3>
          <p>Reload Monit configuration and wait for it to become aware of the given service.</p>

          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/reload_and_wait.rb', line 18</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:reload_and_wait</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_service_name'>service_name</span> <span class='op'>=</span> <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_script'>script</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit-reload</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_interpreter'>interpreter</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bash</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_user'>user</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>root</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_code'>code</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monit</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>executable</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> reload</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># The Monit daemon suddenly stops after the above reload action in some cases. We are working
</span>  <span class='comment'># around that bug by restarting the Monit daemon here.
</span>  <span class='id identifier rubyid_ruby_block'>ruby_block</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ensure-monit-is-running-after-reloading-for-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_service_name'>service_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_block'>block</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_ensure_monit_daemon_is_running'>ensure_monit_daemon_is_running</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ruby_block'>ruby_block</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wait-for-monit-reload-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_block'>block</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_wait_for_monit_service_to_exist'>wait_for_monit_service_to_exist</span><span class='lparen'>(</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
    
  
    
    
      
        <div class="method_details first">
          <h3 class="signature"><a name="run">
            <strong>run</strong>
            &nbsp;(Chef::Provider::MonitWrapperNotifyIfNotRunning)
          </a></h3>
          <p>Notifies subscribing resources if the given Monit service is not running.</p>

          

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18
19
20
21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'providers/notify_if_not_running.rb', line 16</span>

<span class='id identifier rubyid_action'>action</span> <span class='symbol'>:run</span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_monit_service_running?'>monit_service_running?</span><span class='lparen'>(</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>verbose:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Service </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is running, not sending notification</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Service </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not running, sending notification</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_resource'>new_resource</span><span class='period'>.</span><span class='id identifier rubyid_updated_by_last_action'>updated_by_last_action</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

        </div>
      
    
  






</div>


</div>
</div>

    <div id="footer">
  Generated on Tue Jan  5 18:38:27 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.7).
</div>

  </body>
</html>